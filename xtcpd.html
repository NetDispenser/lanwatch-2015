<html>
<head>
<title>XTCPD</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<style>
#bg{width:100%;height:90%;background-color:teal;color:white;overflow:auto;}
.button{width:100px;height:30px;background:red;color:white;}
</style>
<script type="text/javascript" src="/static/xtcpd/js/config.js"></script>
<script type="text/javascript">

new_xhr=function(){
	var xhr=null;
	try{xhr=new ActiveXObject('Msxml2.XMLHTTP');}
	catch(e){
		try{xhr=new ActiveXObject('Microsoft.XMLHTTP');}
		catch(e2){
			try{xhr=new XMLHttpRequest();}
			catch(e3){xhr=null;}
		}
	}
	return xhr;
}
window.decode=function(str){
	var div = document.createElement('div');
	div.innerHTML = str;
	var decoded=str;
	try{
		decoded = div.firstChild.nodeValue;
	}
	catch(e){;}
	return decoded;
}
window.render_data=function(data){
	var pyld=JSON.parse(window.decode(data));
	var bg=document.getElementById("bg");
	try{
		var msg='';
		for(var kidx=0;kidx<pyld['keys'].length;kidx++){
			var key=pyld['keys'][kidx];
			msg+=key+":"+pyld[key]+"<br>";
		}
		bg.innerHTML=msg;
	}
	catch(e){
		console.log(e);
	}
}
var TIMEOUT=1500;
var RUNNING=true;
window.xajax=function(what){
	var xhr=new_xhr();
	xhr.onreadystatechange=function(){
		if(xhr.readyState==4){
			if(xhr.status==200){
				//console.log(what+" returned "+xhr.responseText);
			}
		}
	}
	//xhr.open('Get',"http://hotspot.asymptopia.org/xtcpd?"+what,true);
	//console.log(xtcpd_hostname+"/xtcpd?"+what);
	xhr.open('Get',xtcpd_hostname+"/?"+what,true);
	xhr.setRequestHeader("Content-type", "application/x-www-form-urlencoded");
	xhr.send("");
}
var debugCB=function(e){
	console.log("DEBUG_CALLBACK");
	window.xajax("toggle_debug");
}
var runningCB=function(e){
	console.log("RUNNING_CALLBACK");
	window.xajax("toggle_running");
}
var reloadCB=function(e){
	console.log("RELOAD_CALLBACK");
	window.xajax("reload_config");
}
var resetCB=function(e){
	console.log("RESET_CALLBACK");
	window.xajax("reset");
}
var toggle_updatesCB=function(e){
	console.log("TOGGLE_UPDATES");
	if(RUNNING){
		RUNNING=false;
	}
	else{
		RUNNING=true;
		setTimeout("window.update()",TIMEOUT);
	}
}
window.update=function(){
	var xhr=new_xhr();
	xhr.onreadystatechange=function(){
		if(xhr.readyState==4){
			if(xhr.status==200){
				try{
					//console.log(xhr.responseText);
					window.render_data(xhr.responseText);

					if(RUNNING==true){
						setTimeout("window.update()",TIMEOUT);
					}
				}catch(e){
					console.log(e)
					if(RUNNING==true){
						setTimeout("window.update()",TIMEOUT);
					}
				}
			}
		}
	}
//	xhr.open('Get',"http://hotspot.asymptopia.org/xtcpd?get_data",true);
//	console.log(xtcpd_hostname+"/xtcpd?get_data");
	xhr.open('Get',xtcpd_hostname+"?get_data",true);
	xhr.setRequestHeader("Content-type", "application/x-www-form-urlencoded");
	xhr.send("");
}

window.update();
</script>
</head>
<body>
<div id="bg">
	<h1>ready ... </h1>
</div>

<table>
<tr>
<td>
<div id="debugB" class="button" onclick="debugCB()">
<span>Toggle Debugging</span>
</div>
</td><td>
<div id="runningB" class="button" onclick="runningCB()">
<span>Engage Daemon</span>
</div>
</td><td>
<div id="updateB" class="button" onclick="toggle_updatesCB()">
<span>Toggle Updates</span>
</div>
</td><td>
<div id="reloadB" class="button" onclick="reloadCB()">
<span>Reload Config</span>
</div>
</td><td>
<div id="resetB" class="button" onclick="resetCB()">
<span>Reset</span>
</div>
</td>
</tr>
</table>

</body>
</html>
